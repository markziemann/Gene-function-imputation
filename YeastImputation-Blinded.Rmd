---
title: "Yeast Gene Imputation (blinded data)"
author: "M.Soria"
date: "19/10/2020"
output: html_document
---
</br>

***

##### The following code imputes function on genes from Sacharromyces cerevisiae. Some of the genes were randomly chosen and "blinded" for testing recall.
***

</br>

### Prerequisite libraries
```{r Libraries, echo=TRUE}
suppressPackageStartupMessages({
    library(R.utils)
    library(dplyr)
    library(tidyr)
    library(data.table)
    library(RColorBrewer)
    library(gplots)
    library(Polychrome)
    library(tidyverse)
    library(caret)
    library(ggplot2)
    library(reshape2)
    library(tools)
})

source("functions.R")

```
</br>

### Load Pre-requisite RDS files 
```{r echo=TRUE}
file_logcounts_PASS <- "logcounts_PASS.rds"
file_agg <- "agg.rds"
file_clusters <- "clusters.rds"
file_GO <-"GO_table.rds"
file_GO_allClusters <- "GOterms_allClusters.rds"
file_corr_allClusters <- "corr_allClusters.rds"
file_wGO_allClusters <- "wGO_allClusters.rds"
file_GOterms_perCl <- "GOterms_perCl.rds"
file_cuttree_values <- "cuttree_values.rds"

logcounts <- readRDS(file_logcounts_PASS)
agg <- readRDS(file_agg)
clusters <- readRDS(file_clusters)
GO_table <- readRDS(file_GO)
GO_allClusters <-  readRDS(file_GO_allClusters)
corr_allClusters <-  readRDS(file_corr_allClusters)
wGO_allClusters <- readRDS(file_wGO_allClusters)
GOterms_perCl <- readRDS(file_GOterms_perCl)
cuttree_values <- readRDS(file_cuttree_values) 
```

### 1. Blinding known GO terms

```{r}
#Fraction of the total number of genes to be blinded
nfolds <- 10

set.seed(42)
folds <- sample(1:nfolds, nrow(GO_table), replace = TRUE)
#fix rownames
dict_folds <- data.frame(GO_table$GeneID, folds)

saveRDS(dict_folds, "dict_folds.rds")


# Make a data matrix with the blinded genes = 0
which_fold <- 3

ind_blinded <- which(dict_folds$folds == which_fold)
GO_blinded <- GO_table

GO_blinded[ind_blinded, 2:ncol(GO_blinded)] = 0

```

### 2a. Impute using Pearson method to measure the distance matrix and complete as linkage method during the clustering process (This algorithm will be called PandC)

```{r }

# Get the GO terms by cluster using the blinded data 
# and the GO list per cluster


GO_blindedClusters <- GO_per_cl_blinded(GO_blinded, 
                        clusters, GOterms_perCl, 100)

saveRDS(GO_blindedClusters, "GO_blindedClusters.rds")

wGO_blinded <- impute(cl_GOall = GO_blindedClusters, 
     corr_clAll = corr_allClusters,
     clust_total = 100, thresh = 0.02)

saveRDS(wGO_blinded, "wGO_blinded.rds")

```
</br>


### 2b. Coarse Sweep for Pearson + complete linkage (PandC)
The following code will perform a K-fold validation for the imputation process which uses Pearson method to measure the distance matrix and complete as linkage method during the clustering process. 

```{r}
# Coarse sweep of the following parameters: cluster total(20, 50, 200, 500) and threshold (0.1, 0.4, 0.8)

# for 20 clusters (run inputs)
# ---------------------- 
cluster20 <- cuttree_values[["20"]][["GeneID_assignments"]]
corr_allClusters20 <- corr_per_clust(logcounts, cluster20, 20)
GOterms_perCl20 <- GO_per_cl(GO_table, cluster20, 20)
GO_list_perCl20 <- GO_list_perClBlind(GOterms_perCl20, 20)

GO_blindedClusters20 <- GO_per_cl_blinded(GO_blinded, 
                        cluster20, GO_list_perCl20, 20)

wGO_blinded20 <- impute(cl_GOall=GOterms_perCl20, 
                        corr_clAll=corr_allClusters20, 
                        clust_total=20, thresh=0)

# stats for thresholds 
wGO_allClusters20_10 <- impute(cl_GOall = GOterms_perCl20, 
                        corr_clAll = corr_allClusters20,
                        clust_total = 20, thresh = 0.1)
PandC20_10_test <- cross_val(n=10, GO_annot=GO_table, clusters=cluster20,
                       GO_list_perCl=GO_list_perCl20, 
                       corr_clAll=corr_allClusters20,
                       wGO_allClusters=wGO_allClusters20_10,
                       clust_total=20, thresh=0.1)
saveRDS(PandC20_10, "PandC20_10.rds")



wGO_allClusters20_40 <- impute(cl_GOall = GOterms_perCl20, 
                        corr_clAll = corr_allClusters20,
                        clust_total = 20, thresh = 0.4)
PandC20_40 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster20,
                       GO_list_perCl=GO_list_perCl20, 
                       corr_clAll=corr_allClusters20,
                       wGO_allClusters=wGO_allClusters20_40,
                       clust_total=20, thresh=0.4)
saveRDS(PandC20_40, "PandC20_40.rds")



start.time <- Sys.time()
wGO_allClusters20_80 <- impute(cl_GOall = GOterms_perCl20, 
     corr_clAll = corr_allClusters20,
     clust_total = 20, thresh = 0.8)

PandC20_80 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster20,
                       GO_list_perCl=GO_list_perCl20, 
                       corr_clAll=corr_allClusters20,
                       wGO_allClusters=wGO_allClusters20_80,
                       clust_total=20, thresh=0.8)
saveRDS(PandC20_80, "PandC20_80.rds")
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken
# ---------------------- 


# for 50 clusters (run inputs)
# ---------------------- 
cluster50 <- cuttree_values[["50"]][["GeneID_assignments"]]
corr_allClusters50 <- corr_per_clust(logcounts, cluster50, 50)
GOterms_perCl50 <- GO_per_cl(GO_table, cluster50, 50)
GO_list_perCl50 <- GO_list_perClBlind(GOterms_perCl50, 50)

GO_blindedClusters50 <- GO_per_cl_blinded(GO_blinded, 
                        cluster50, GO_list_perCl50, 50)

#wGO_blinded50 <- impute(cl_GOall=GOterms_perCl50, 
#                        corr_clAll=corr_allClusters50, 
#                        clust_total=50, thresh=0)

# stats for thresholds 
wGO_allClusters50_10 <- impute(cl_GOall = GOterms_perCl50, 
                        corr_clAll = corr_allClusters50,
                        clust_total = 50, thresh = 0.1)
PandC50_10 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster50,
                       GO_list_perCl=GO_list_perCl50, 
                       corr_clAll=corr_allClusters50,
                       wGO_allClusters=wGO_allClusters50_10,
                       clust_total=50, thresh=0.1)
saveRDS(PandC50_10, "PandC50_10.rds")


wGO_allClusters50_40 <- impute(cl_GOall = GOterms_perCl50, 
                        corr_clAll = corr_allClusters50,
                        clust_total = 50, thresh = 0.4)
PandC50_40 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster50,
                       GO_list_perCl=GO_list_perCl50, 
                       corr_clAll=corr_allClusters50,
                       wGO_allClusters=wGO_allClusters50_40,
                       clust_total=50, thresh=0.4)
saveRDS(PandC50_40, "PandC50_40.rds")

start.time <- Sys.time()
wGO_allClusters50_80 <- impute(cl_GOall = GOterms_perCl50, 
                        corr_clAll = corr_allClusters50,
                        clust_total = 50, thresh = 0.8)

PandC50_80 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster50,
                       GO_list_perCl=GO_list_perCl50, 
                       corr_clAll=corr_allClusters50,
                       wGO_allClusters=wGO_allClusters50_80,
                       clust_total=50, thresh=0.8)
saveRDS(PandC50_80, "PandC50_80.rds")
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken
# ---------------------- 


# for 200 clusters (run inputs)
# ---------------------- 
cluster200 <- cuttree_values[["200"]][["GeneID_assignments"]]
corr_allClusters200 <- corr_per_clust(logcounts, cluster200, 200)
GOterms_perCl200 <- GO_per_cl(GO_table, cluster200, 200)
GO_list_perCl200 <- GO_list_perClBlind(GOterms_perCl200, 200)

GO_blindedClusters200 <- GO_per_cl_blinded(GO_blinded, 
                        cluster200, GO_list_perCl200, 200)

# stats for thresholds 
wGO_allClusters200_10 <- impute(cl_GOall = GOterms_perCl200, 
                        corr_clAll = corr_allClusters200,
                        clust_total = 200, thresh = 0.1)

PandC200_10 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster200,
                       GO_list_perCl=GO_list_perCl200, 
                       corr_clAll=corr_allClusters200,
                       wGO_allClusters=wGO_allClusters200_10,
                       clust_total=200, thresh=0.1)
saveRDS(PandC200_10, "PandC200_10.rds")


wGO_allClusters200_40 <- impute(cl_GOall = GOterms_perCl200, 
                        corr_clAll = corr_allClusters200,
                        clust_total = 200, thresh = 0.4)
PandC200_40 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster200,
                       GO_list_perCl=GO_list_perCl200, 
                       corr_clAll=corr_allClusters200,
                       wGO_allClusters=wGO_allClusters200_40,
                       clust_total=200, thresh=0.4)
saveRDS(PandC200_40, "PandC200_40.rds")

start.time <- Sys.time()
wGO_allClusters200_80 <- impute(cl_GOall = GOterms_perCl200, 
                        corr_clAll = corr_allClusters200,
                        clust_total = 200, thresh = 0.8)

PandC200_80 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster200,
                       GO_list_perCl=GO_list_perCl200, 
                       corr_clAll=corr_allClusters200,
                       wGO_allClusters=wGO_allClusters200_80,
                       clust_total=200, thresh=0.8)
saveRDS(PandC200_80, "PandC200_80.rds")
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken
# ---------------------- 


# for 500 clusters (run inputs)
# ---------------------- 
cluster500 <- cuttree_values[["500"]][["GeneID_assignments"]]
corr_allClusters500 <- corr_per_clust(logcounts, cluster500, 500)
GOterms_perCl500 <- GO_per_cl(GO_table, cluster500, 500)
GO_list_perCl500 <- GO_list_perClBlind(GOterms_perCl500, 500)

GO_blindedClusters500 <- GO_per_cl_blinded(GO_blinded, 
                        cluster500, GO_list_perCl500, 500)

# stats for thresholds 
wGO_allClusters500_10 <- impute(cl_GOall = GOterms_perCl500, 
                        corr_clAll = corr_allClusters500,
                        clust_total = 500, thresh = 0.1)
PandC500_10 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster500,
                       GO_list_perCl=GO_list_perCl500, 
                       corr_clAll=corr_allClusters500,
                       wGO_allClusters=wGO_allClusters500_10,
                       clust_total=500, thresh=0.1)
saveRDS(PandC500_10, "PandC500_10.rds")


wGO_allClusters500_40 <- impute(cl_GOall = GOterms_perCl500, 
                        corr_clAll = corr_allClusters500,
                        clust_total = 500, thresh = 0.4)
PandC500_40 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster500,
                       GO_list_perCl=GO_list_perCl500, 
                       corr_clAll=corr_allClusters500,
                       wGO_allClusters=wGO_allClusters500_40,
                       clust_total=500, thresh=0.4)
saveRDS(PandC500_40, "PandC500_40.rds")

start.time <- Sys.time()
wGO_allClusters500_80 <- impute(cl_GOall = GOterms_perCl500, 
                        corr_clAll = corr_allClusters500,
                        clust_total = 500, thresh = 0.8)

PandC500_80 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster500,
                       GO_list_perCl=GO_list_perCl500, 
                       corr_clAll=corr_allClusters500,
                       wGO_allClusters=wGO_allClusters500_80,
                       clust_total=500, thresh=0.8)
saveRDS(PandC500_80, "PandC500_80.rds")
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken
# ----------------------


# for 300 clusters (run inputs)
# ---------------------- 
cluster300 <- cuttree_values[["300"]][["GeneID_assignments"]]
corr_allClusters300 <- corr_per_clust(logcounts, cluster300, 300)
GOterms_perCl300 <- GO_per_cl(GO_table, cluster300, 300)
GO_list_perCl300 <- GO_list_perClBlind(GOterms_perCl300, 300)

GO_blindedClusters300 <- GO_per_cl_blinded(GO_blinded, 
                        cluster300, GO_list_perCl300, 300)

# stats for thresholds 
wGO_allClusters300_10 <- impute(cl_GOall = GOterms_perCl300, 
                        corr_clAll = corr_allClusters300,
                        clust_total = 300, thresh = 0.1)
PandC300_10 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster300,
                       GO_list_perCl=GO_list_perCl300, 
                       corr_clAll=corr_allClusters300,
                       wGO_allClusters=wGO_allClusters300_10,
                       clust_total=300, thresh=0.1)
saveRDS(PandC300_10, "PandC300_10.rds")


wGO_allClusters300_40 <- impute(cl_GOall = GOterms_perCl300, 
                        corr_clAll = corr_allClusters300,
                        clust_total = 300, thresh = 0.4)
PandC300_40 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster300,
                       GO_list_perCl=GO_list_perCl300, 
                       corr_clAll=corr_allClusters300,
                       wGO_allClusters=wGO_allClusters300_40,
                       clust_total=300, thresh=0.4)
saveRDS(PandC300_40, "PandC300_40.rds")

start.time <- Sys.time()
wGO_allClusters300_80 <- impute(cl_GOall = GOterms_perCl300, 
                        corr_clAll = corr_allClusters300,
                        clust_total = 300, thresh = 0.8)

PandC300_80 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster300,
                       GO_list_perCl=GO_list_perCl300, 
                       corr_clAll=corr_allClusters300,
                       wGO_allClusters=wGO_allClusters300_80,
                       clust_total=300, thresh=0.8)
saveRDS(PandC300_80, "PandC300_80.rds")
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken
# ---------------------- 


# for 100 clusters (run inputs)
# ---------------------- 
cluster100 <- cuttree_values[["100"]][["GeneID_assignments"]]
corr_allClusters100 <- corr_per_clust(logcounts, cluster100, 100)
GOterms_perCl100 <- GO_per_cl(GO_table, cluster100, 100)
GO_list_perCl100 <- GO_list_perClBlind(GOterms_perCl100, 100)

GO_blindedClusters100 <- GO_per_cl_blinded(GO_blinded, 
                        cluster100, GO_list_perCl100, 100)

# stats for thresholds 
wGO_allClusters100_10 <- impute(cl_GOall = GOterms_perCl100, 
                        corr_clAll = corr_allClusters100,
                        clust_total = 100, thresh = 0.1)
PandC100_10 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster100,
                       GO_list_perCl=GO_list_perCl100, 
                       corr_clAll=corr_allClusters100,
                       wGO_allClusters=wGO_allClusters100_10,
                       clust_total=100, thresh=0.1)
saveRDS(PandC100_10, "PandC100_10.rds")


wGO_allClusters100_40 <- impute(cl_GOall = GOterms_perCl100, 
                        corr_clAll = corr_allClusters100,
                        clust_total = 100, thresh = 0.4)
PandC100_40 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster100,
                       GO_list_perCl=GO_list_perCl100, 
                       corr_clAll=corr_allClusters100,
                       wGO_allClusters=wGO_allClusters100_40,
                       clust_total=100, thresh=0.4)
saveRDS(PandC100_40, "PandC100_40.rds")

start.time <- Sys.time()
wGO_allClusters100_80 <- impute(cl_GOall = GOterms_perCl100, 
                        corr_clAll = corr_allClusters100,
                        clust_total = 100, thresh = 0.8)

PandC100_80 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster100,
                       GO_list_perCl=GO_list_perCl100, 
                       corr_clAll=corr_allClusters100,
                       wGO_allClusters=wGO_allClusters100_80,
                       clust_total=100, thresh=0.8)
saveRDS(PandC100_80, "PandC100_80.rds")
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken
# ---------------------- 


# for 1000 clusters (run inputs)
# ---------------------- 
cluster1000 <- cuttree_values[["1000"]][["GeneID_assignments"]]
corr_allClusters1000 <- corr_per_clust(logcounts, cluster1000, 1000)

GOterms_perCl1000 <- GO_per_cl(GO_table, cluster1000, 1000)
saveRDS(GOterms_perCl1000, "GOterms_perCl1000.rds")
GO_list_perCl1000 <- GO_list_perClBlind(GOterms_perCl1000, 1000)
saveRDS(GO_list_perCl1000,"GO_list_perCl1000.rds")
GO_blindedClusters1000 <- GO_per_cl_blinded(GO_blinded, 
                        cluster1000, GO_list_perCl1000, 1000)
saveRDS(GO_blindedClusters1000, "GO_blindedClusters1000.rds")
# stats for thresholds 
wGO_allClusters1000_10 <- impute(cl_GOall = GOterms_perCl1000, 
                        corr_clAll = corr_allClusters1000,
                        clust_total = 1000, thresh = 0.1)
PandC1000_10 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster1000,
                       GO_list_perCl=GO_list_perCl1000, 
                       corr_clAll=corr_allClusters1000,
                       wGO_allClusters=wGO_allClusters1000_10,
                       clust_total=1000, thresh=0.1)
saveRDS(PandC1000_10, "PandC1000_10.rds")

start.time <- Sys.time()
wGO_allClusters1000_40 <- impute(cl_GOall = GOterms_perCl1000, 
                        corr_clAll = corr_allClusters1000,
                        clust_total = 1000, thresh = 0.4)
PandC1000_40 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster1000,
                       GO_list_perCl=GO_list_perCl1000, 
                       corr_clAll=corr_allClusters1000,
                       wGO_allClusters=wGO_allClusters1000_40,
                       clust_total=1000, thresh=0.4)
saveRDS(PandC1000_40, "PandC1000_40.rds")
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken


start.time <- Sys.time()
wGO_allClusters1000_80 <- impute(cl_GOall = GOterms_perCl1000, 
                        corr_clAll = corr_allClusters1000,
                        clust_total = 1000, thresh = 0.8)

PandC1000_80 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster1000,
                       GO_list_perCl=GO_list_perCl1000, 
                       corr_clAll=corr_allClusters1000,
                       wGO_allClusters=wGO_allClusters1000_80,
                       clust_total=1000, thresh=0.8)
saveRDS(PandC1000_80, "PandC1000_80.rds")
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken

PandC1000_90 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster1000,
                       GO_list_perCl=GO_list_perCl1000, 
                       corr_clAll=corr_allClusters1000,
                       wGO_allClusters=wGO_allClusters1000_90,
                       clust_total=1000, thresh=0.9)
saveRDS(PandC1000_80, "PandC1000_90.rds")

PandC1000_100 <- cross_val(n=10, GO_annot=GO_table, clusters=cluster1000,
                       GO_list_perCl=GO_list_perCl1000, 
                       corr_clAll=corr_allClusters1000,
                       wGO_allClusters=wGO_allClusters1000_100,
                       clust_total=1000, thresh=1)
saveRDS(PandC1000_80, "PandC1000_100.rds")
# ---------------------- 

```

### 2c. Summary of performace measures for Pearson + complete linkage

```{r}

# Get the list of all the files for Pearson + complete linkage kfold validation
files <- list.files(pattern ='^PandC.')
# Get the list of all the PandC rds files sans extension
files_names <- file_path_sans_ext(list.files(pattern ='^PandC.'))
# Put all the dataframes in one list
dat_list <- sapply(files,function (x) readRDS(x), simplify = FALSE, USE.NAMES = TRUE)
# Change the names to get rid of the extension
names(dat_list2) <- files_names

# Number of gene IDs with no GO IDs
no_ontologies1 <- setdiff(unique(rownames(agg)),unique(GO_table$GeneID))
length(no_ontologies1)

# Put all the F1 socres of each fold in one array
F1_PandC <- sapply(dat_list, function(x){
  sapply(x, function(x) {x[length(x)]})
}, simplify = "array", USE.NAMES = TRUE)

# Transform the array into a dataframe 
F1_PandC_list <- as.data.frame(F1_PandC)
F1_PandC_df <- t(do.call(rbind, lapply(F1_PandC_list, data.frame, stringsAsFactors=FALSE)))
# Get the mean for each column and append to the existing table
Mean.F1_Score <- colMeans(F1_PandC_df)
F1_PandC_df <- rbind(F1_PandC_df, Mean.F1_Score)
rownames(F1_PandC_df)[rownames(F1_PandC_df) == "11"] <- "Mean.F1_Score"
saveRDS(F1_PandC_df, "F1_PandC_df.rds")

# List the all the mean predicton scores for each parameter 
summary_all_PandC <- summary_Csweep(dat_list)
saveRDS(summary_all_PandC, "summary_all_PandC.rds")


```

### 5. Visualizations

```{r}

# correlations of the counts (Pearson - default; Spearman)
corr_logcounts <- cor(t(logcounts))
saveRDS(corr_logcounts,"corr_logcounts.rds")

corr_logcounts_spearman <- cor(t(logcounts), method = "spearman")
saveRDS(corr_logcounts,"corr_logcounts_spearman.rds")

# Get lower triangle of the correlation matrix
corr_lowertri <- corr_logcounts
corr_lowertri[upper.tri(corr_counts_lowertri)] <- NA

# Melt the correlation matrix
 melted_cormat <- melt(corr_lowertri, na.rm = TRUE)
 melted_cormat <- melted_cormat[which(melted_cormat$Var1 != melted_cormat$Var2),]
 melted_cormat <- melted_cormat[which(melted_cormat$value != 1),]
 melted_cormat <- melted_cormat[order(-melted_cormat$value),]

# Heatmap
png("Data/yeast_heatmaps_PASS_corrlogcounts4.png",    # create PNG for the heat map
  width = 5*300,        # 5 x 300 pixels
  height = 5*300,
  res = 300,            # 300 pixels per inch
  pointsize = 8)        # smaller font size

ggplot(data = melted_cormat[1:10000,], aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white",
   midpoint = 0, limit = c(-1,1), space = "Lab",
   name="Pearson\nCorrelation") +
  theme_minimal()+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) +
 coord_fixed()

dev.off()


# creates a own color palette from red to green
#my_palette <- colorRampPalette(c("yellow", "orange", "red"))
my_palette <- colorRampPalette(c("red", "black", "green"))


# (optional) defines the color breaks manually for a "skewed" color transition
col_breaks = c(seq(-1,0,length=100), # for red
seq(0.01,0.8,length=100),  # for yellow
seq(0.81,1,length=100)) # for green

start.time <- Sys.time()
png("Data/yeast_heatmaps_PASS_corrlogcounts3.png",    # create PNG for the heat map
  width = 5*300,        # 5 x 300 pixels
  height = 5*300,
  res = 300,            # 300 pixels per inch
  pointsize = 8)        # smaller font size

heatmap.2(melted_cormat[1:10000,],
  main = "Correlation of Counts", # heat map title
  margins =c(5,5),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  trace="none",
  dendrogram="both",     # only draw a row dendrogram
  Rowv=T,
  Colv=T,
  symm=F,symkey=F,symbreaks=T, scale="none")


dev.off()
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken


# histogram - Pearson Method
png("Data/yeast_histograms_PASS_corrlogcounts.png",    # create PNG for the heat map
  width = 5*300,        # 5 x 300 pixels
  height = 5*300,
  res = 300,            # 300 pixels per inch
  pointsize = 8)        # smaller font size

hist(melted_cormat,
     main="Correlation of Counts (Pearson Method)",
     xlab="Normalised RNA Seq Counts")

dev.off()

# histogram - Spearman Method
png("Data/yeast_histograms_PASS_corrlogcounts_spearman.png",
  width = 5*300,        # 5 x 300 pixels
  height = 5*300,
  res = 300,            # 300 pixels per inch
  pointsize = 8)        # smaller font size

hist(corr_logcounts,
     main="Correlation of Counts (Spearman Method)",
     xlab="Normalised RNA Seq Counts")

dev.off()


# cut tree value vs Total Clusters – line diagram
cuttree_totals_df <- as.data.frame(as.numeric(names(cuttree_values)))
m <- list()
for (i in 1:length(cuttree_values)){
  x <- cuttree_values[[i]][["Cut_value"]]
  m[[i]] <- x
}
cuttree_totals_df$CuttreeVal <- as.numeric(m)
colnames(cuttree_totals_df)[1] <- "ClTot"

png("Data/yeast_line_PASS_cuttree_vs_clTotal.png",
  width = 5*300,        # 5 x 300 pixels
  height = 5*300,
  res = 300,            # 300 pixels per inch
  pointsize = 8)        # smaller font size

ggplot(cuttree_totals_df, aes(x=CuttreeVal, y=ClTot)) +
  geom_line() + ylab("Total Number of Clusters") +
  xlab("Cuttree Values") +
  ggtitle("Cuttree Value vs Total Number of Clusters") +
  theme(plot.title = element_text(hjust = 0.5))

dev.off()


# Total genes per cluster  – line diagram
clTotals <- do.call(rbind.data.frame, sapply(cuttree_values, "[[", 3))
clTotals$ClTot <- as.factor(as.numeric(str_extract_all(rownames(clTotals), "^[:digit:]*(?=.)")))
clTotals$ClNum <- as.numeric(str_extract_all(rownames(clTotals), "(?=.)\\d+$"))
colnames(clTotals)[1] <- "GeneTot"
rownames(clTotals) <- c()


png("Data/yeast_violin_PASS_genesPerCl2.png",
  width = 5*300,        # 5 x 300 pixels
  height = 5*300,
  res = 300,            # 300 pixels per inch
  pointsize = 8)        # smaller font size

ggplot(clTotals, aes(x=ClNum, y=GeneTot, color=ClTot)) +
  geom_violin(trim=FALSE) + ylab("Total Number of Genes") +
  xlab("Cluster Number") +
  ggtitle("Total Number of Genes per Cluster") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(legend.position="none")

dev.off()

```

### Session Information 

```{r Session Info, echo=FALSE}
sessionInfo()
```
