---
title: "Yeast Gene Imputation (blinded data)"
author: "M.Soria"
date: "19/10/2020"
output: html_document
---
</br>

***

##### The following code imputes function on genes from Sacharromyces cerevisiae. Some of the genes were randomly chosen and "blinded" for testing recall.
***

</br>

### Prerequisite libraries
```{r Libraries, echo=TRUE}
suppressPackageStartupMessages({
    library(R.utils)
    library(dplyr)
    library(tidyr)
    library(data.table)
    library(RColorBrewer)
    library(gplots)
    library(Polychrome)
    library(tidyverse)
    library(caret)
})

source("functions.R")

```
</br>

### Load Pre-requisite RDS files 
```{r echo=TRUE}
file_logcounts_PASS <- "logcounts_PASS.rds"
file_agg <- "agg.rds"
file_clusters <- "clusters.rds"
file_GO <-"GO_table.rds"
file_GO_allClusters <- "GOterms_allClusters.rds"
file_corr_allClusters <- "corr_allClusters.rds"
file_wGO_allClusters <- "wGO_allClusters.rds"

logcounts <- readRDS(file_logcounts_PASS)
agg <- readRDS(file_agg)
clusters <- readRDS(file_clusters)
GO_table <- readRDS(file_GO)
GO_allClusters <-  readRDS(file_GO_allClusters)
corr_allClusters <-  readRDS(file_corr_allClusters)
wGO_allClusters <- readRDS(file_wGO_allClusters)
```


### 1. Blinding known GO terms

```{r}
#Fraction of the total number of genes to be blinded
frac_blind <- 0.10
number_of_genes <- round(nrow(GO_table)*frac_blind)

set.seed(42)
blind <- sample(GO_table$GeneID, number_of_genes)

rand <- paste("blind_", blind, sep = "")
dict_blind <- data.frame(blind, rand)

saveRDS(dict_blind, "dict_blind.rds")

# Make a data matrix with the blinded genes = 0
GO_blinded <- GO_table
ind_blinded <- which(GO_table$GeneID %in% blind)
GO_blinded[ind_blinded, 1] <- rand
GO_blinded[ind_blinded, 2:ncol(GO_blinded)] = 0
```
</br>

### 2. Group Blinded GO terms according to cluster

```{r }

GO_blindedClusters <- GO_per_cl(GO_blinded, clusters, 100)

```
</br>


### 3. Impute using blinded GO terms 

```{r }

start.time <- Sys.time()

wGO_blinded <- impute(cl_GOall = GO_blindedClusters, 
     corr_clAll = corr_allClusters,
     clust_total = 100, thresh = 0.02)

end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken

```
</br>

### 4. Build a Confusion Matrix

```{r }
# prediction
cluster1_blind <- wGO_blinded[["Cluster1"]][["Diff"]]

# convert to Y and N to factor
prediction <- mutate_if(cluster1_blind, is.numeric, as.factor) 
rownames(prediction) <- rownames(cluster1_blind)

# reference
cluster1 <- wGO_allClusters[["Cluster1"]][["Input"]]

# convert to Y and N to factor
reference <- mutate_if(cluster1, is.numeric, as.factor) 
rownames(reference) <- rownames(cluster1)


conf_matrix.cl1 <- confusionMatrix(prediction[,1], reference[,1])

```
</br>


### Session Information 

```{r Session Info, echo=FALSE}
sessionInfo()
```
