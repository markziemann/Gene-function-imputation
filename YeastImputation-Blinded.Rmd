---
title: "Yeast Gene Imputation (blinded data)"
author: "M.Soria"
date: "19/10/2020"
output: html_document
---
</br>

***

##### The following code imputes function on genes from Sacharromyces cerevisiae. Some of the genes were randomly chosen and "blinded" for testing recall.
***

</br>

### Prerequisite libraries
```{r Libraries, echo=TRUE}
suppressPackageStartupMessages({
    library(R.utils)
    library(dplyr)
    library(tidyr)
    library(data.table)
    library(RColorBrewer)
    library(gplots)
    library(Polychrome)
    library(tidyverse)
    library(caret)
})

source("functions.R")

```
</br>

### Load Pre-requisite RDS files 
```{r echo=TRUE}
file_logcounts_PASS <- "logcounts_PASS.rds"
file_agg <- "agg.rds"
file_clusters <- "clusters.rds"
file_GO <-"GO_table.rds"
file_GO_allClusters <- "GOterms_allClusters.rds"
file_corr_allClusters <- "corr_allClusters.rds"
file_wGO_allClusters <- "wGO_allClusters.rds"
file_GOterms_perCl <- "GOterms_perCl.rds"

logcounts <- readRDS(file_logcounts_PASS)
agg <- readRDS(file_agg)
clusters <- readRDS(file_clusters)
GO_table <- readRDS(file_GO)
GO_allClusters <-  readRDS(file_GO_allClusters)
corr_allClusters <-  readRDS(file_corr_allClusters)
wGO_allClusters <- readRDS(file_wGO_allClusters)
GOterms_perCl <- readRDS(file_GOterms_perCl)
```

### 1. Blinding known GO terms

```{r}
#Fraction of the total number of genes to be blinded
nfolds <- 10

set.seed(42)
folds <- sample(1:nfolds, nrow(GO_table), replace = TRUE)
#fix rownames
dict_folds <- data.frame(GO_table$GeneID, folds)

saveRDS(dict_blind, "dict_folds.rds")


# Make a data matrix with the blinded genes = 0
which_fold <- 1

ind_blinded <- which(dict_folds$folds == which_fold)
GO_blinded <- GO_table

GO_blinded[ind_blinded, 2:ncol(GO_blinded)] = 0

```
</br>

### 2. Group Blinded GO terms according to cluster

```{r }



```
</br>


### 3. Impute using blinded GO terms 

```{r }

# Get the GO terms by cluster using the blinded data and the GO list per cluster

GO_blindedClusters <- GO_per_cl_blinded(GO_blinded, clusters, GOterms_perCl, 100)


wGO_blinded <- impute(cl_GOall = GO_blindedClusters, 
     corr_clAll = corr_allClusters,
     clust_total = 100, thresh = 0.02)


```
</br>

### 4. Measures of performance 

```{r}

# per cluster

stats_perCl <- stats_cl(wGO_allClusters, wGO_blinded, 100)

stats_perCl[["Cluster50"]]


#for the entire data frame

stats_final <- stats_all(stats_perCl)

stats_final

```

### 5. ROC and AUC 

```{r}


```


### Session Information 

```{r Session Info, echo=FALSE}
sessionInfo()
```
